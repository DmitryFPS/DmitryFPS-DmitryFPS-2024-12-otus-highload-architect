# Отчет по тестированию производительности запросов до и после добавления индексов

## Описание теста

- Был проведен тест производительности запроса к базе данных до и после добавления индексов.
- Запрос выполняет поиск пользователей по имени и фамилии, используя оператор `LIKE` для частичного совпадения.
- В тесте использовались различные нагрузки: 1, 10, 100 и 1000 одновременных запросов.

## Результаты тестирования производительности

### 1 одновременный запрос

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 142                    | 112                       |
| Минимальное время (мс)       | 142                    | 112                       |
| Максимальное время (мс)      | 142                    | 112                       |
| Стандартное отклонение (мс)  | 0.00                   | 0.00                      |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 7.04225                | 8.92857                   |
| Получено KB/sec              | 95.48                  | 121.06                    |
| Отправлено KB/sec            | 2.35                   | 2.98                      |
| Средний размер ответа (байт) | 13884.0                | 13884.0                   |

### 10 одновременных запросов

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 58                     | 58                        |
| Минимальное время (мс)       | 42                     | 46                        |
| Максимальное время (мс)      | 119                    | 80                        |
| Стандартное отклонение (мс)  | 21.06                  | 8.22                      |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 10.37344               | 10.41667                  |
| Получено KB/sec              | 140.65                 | 141.24                    |
| Отправлено KB/sec            | 3.46                   | 3.48                      |
| Средний размер ответа (байт) | 13884.0                | 13884.0                   |

### 100 одновременных запросов

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 99                     | 92                        |
| Минимальное время (мс)       | 38                     | 35                        |
| Максимальное время (мс)      | 187                    | 197                       |
| Стандартное отклонение (мс)  | 33.39                  | 39.22                     |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 96.99321               | 97.08738                  |
| Получено KB/sec              | 1315.09                | 1316.37                   |
| Отправлено KB/sec            | 32.39                  | 32.43                     |
| Средний размер ответа (байт) | 13884.0                | 13884.0                   |

### 1000 одновременных запросов

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 3823                   | 3839                      |
| Минимальное время (мс)       | 93                     | 122                       |
| Максимальное время (мс)      | 7331                   | 7241                      |
| Стандартное отклонение (мс)  | 2025.72                | 2019.00                   |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 120.78753              | 121.49192                 |
| Получено KB/sec              | 1637.71                | 1647.26                   |
| Отправлено KB/sec            | 40.34                  | 40.58                     |
| Средний размер ответа (байт) | 13884.0                | 13884.0                   |

### Выводы

### Для одного запроса:

- Добавление индексов привело к снижению среднего времени выполнения запроса с 142 мс до 112 мс, что является
  значительным улучшением.
- Throughput увеличился с 7.04 до 8.93 запросов в секунду.

### Для 10 запросов:

- Среднее время выполнения осталось практически неизменным (58 мс), но стандартное отклонение уменьшилось с 21.06 мс до
  8.22 мс, что указывает на более стабильную производительность.

### Для 100 запросов:

- Среднее время выполнения уменьшилось с 99 мс до 92 мс, а throughput увеличился с 96.99 до 97.09 запросов в секунду.

### Для 1000 запросов:

- Среднее время выполнения практически не изменилось (3823 мс до 3839 мс), но throughput увеличился с 120.79 до 121.49
  запросов в секунду.

- В целом, добавление индексов положительно сказалось на производительности, особенно при низкой нагрузке.
- Однако при высокой нагрузке (1000 запросов) эффект от индексов менее заметен, что может быть связано с другими
  ограничениями системы (например, сетевые задержки или ограничения на стороне сервера).


- [График для одного запроса, без индексов: ](graph_results_1thread.png)
- [График для десяти запросов, без индексов: ](graph_results_10thread.png)
- [График для ста запросов, без индексов: ](graph_results_100thread.png)
- [График для тысячи запросов, без индексов: ](graph_results_1000thread.png)


- [График для одного запроса, с индексами: ](graph_results_1thread_whit_index.png)
- [График для десяти запросов, с индексами: ](graph_results_10thread_whit_index.png)
- [График для ста запросов, с индексами: ](graph_results_100thread_whit_index.png)
- [График для тысячи запросов, с индексами: ](graph_results_1000thread_whit_index.png)

## Схема базы данных

```sql
CREATE TYPE gender_enum AS ENUM ('MALE', 'FEMALE');

CREATE TABLE users
(
    id         BIGSERIAL PRIMARY KEY,
    first_name VARCHAR(50)  NOT NULL,
    last_name  VARCHAR(50)  NOT NULL,
    birth_date DATE         NOT NULL,
    gender     gender_enum  NOT NULL,
    email      VARCHAR(100) NOT NULL UNIQUE,
    password   VARCHAR(100) NOT NULL,
    is_active  BOOLEAN DEFAULT TRUE,
    city_id    BIGINT       NOT NULL,
    token_id   BIGINT,

    CONSTRAINT fk_city FOREIGN KEY (city_id) REFERENCES cities (id),
    CONSTRAINT fk_token FOREIGN KEY (token_id) REFERENCES tokens (id)
);

-- Индексы для внешних ключей
CREATE INDEX idx_users_city_id ON users (city_id);
CREATE INDEX idx_users_token_id ON users (token_id);
CREATE INDEX idx_users_is_active ON users (is_active);

-- Составной индекс на first_name и last_name
CREATE INDEX idx_users_firstname_lastname ON users (first_name, last_name);