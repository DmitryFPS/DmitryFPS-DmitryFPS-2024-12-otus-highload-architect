# Отчет по тестированию производительности запросов до и после добавления индексов

## Описание теста

- Был проведен тест производительности запроса к базе данных до и после добавления индексов.
- Запрос выполняет поиск пользователей по имени и фамилии, используя оператор `LIKE` для частичного совпадения.
- В тесте использовались различные нагрузки: 1, 10, 100 и 1000 одновременных запросов.

## Результаты тестирования производительности

### 1 одновременный запрос

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 90                     | 85                        |
| Минимальное время (мс)       | 90                     | 85                        |
| Максимальное время (мс)      | 90                     | 85                        |
| Стандартное отклонение (мс)  | 0.00                   | 0.00                      |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 11.11111               | 11.76471                  |
| Получено KB/sec              | 205.00                 | 217.06                    |
| Отправлено KB/sec            | 3.69                   | 3.91                      |
| Средний размер ответа (байт) | 18893.0                | 18893.0                   |

### 10 одновременных запросов

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 59                     | 32                        |
| Минимальное время (мс)       | 54                     | 20                        |
| Максимальное время (мс)      | 84                     | 42                        |
| Стандартное отклонение (мс)  | 8.39                   | 6.28                      |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 10.40583               | 10.81081                  |
| Получено KB/sec              | 191.99                 | 199.46                    |
| Отправлено KB/sec            | 3.46                   | 3.59                      |
| Средний размер ответа (байт) | 18893.0                | 18893.0                   |

### 100 одновременных запросов

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 211                    | 11                        |
| Минимальное время (мс)       | 69                     | 8                         |
| Максимальное время (мс)      | 342                    | 36                        |
| Стандартное отклонение (мс)  | 62.74                  | 4.26                      |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 80.90615               | 99.90010                  |
| Получено KB/sec              | 1492.73                | 1843.18                   |
| Отправлено KB/sec            | 26.86                  | 33.17                     |
| Средний размер ответа (байт) | 18893.0                | 18893.0                   |

### 1000 одновременных запросов

| Метрика                      | До добавления индексов | После добавления индексов |
|------------------------------|------------------------|---------------------------|
| Среднее время (мс)           | 4716                   | 354                       |
| Минимальное время (мс)       | 102                    | 23                        |
| Максимальное время (мс)      | 8931                   | 716                       |
| Стандартное отклонение (мс)  | 2495.79                | 151.08                    |
| Ошибки (%)                   | 0.000%                 | 0.000%                    |
| Throughput (запросов/сек)    | 100.66438              | 683.52700                 |
| Получено KB/sec              | 1857.28                | 12611.21                  |
| Отправлено KB/sec            | 33.42                  | 226.95                    |
| Средний размер ответа (байт) | 18893.0                | 18893.0                   |

### Выводы

### Для одного запроса:

- Добавление индексов привело к снижению среднего времени выполнения запроса с 90 мс до 85 мс, что является улучшением.
- Throughput увеличился с 11.11 до 11.76 запросов в секунду.

### Для 10 запросов:

- Среднее время выполнения уменьшилось с 59 мс до 32 мс, что является значительным улучшением.
- Стандартное отклонение уменьшилось с 8.39 мс до 6.28 мс, что указывает на более стабильную производительность.
- Throughput увеличился с 10.41 до 10.81 запросов в секунду.

### Для 100 запросов:

- Среднее время выполнения значительно уменьшилось с 211 мс до 11 мс, что является существенным улучшением.
- Throughput увеличился с 80.91 до 99.90 запросов в секунду.

### Для 1000 запросов:

- Среднее время выполнения значительно уменьшилось с 4716 мс до 354 мс, что является значительным улучшением.
- Throughput увеличился с 100.66 до 683.53 запросов в секунду.

- В целом, добавление индексов положительно сказалось на производительности, особенно при высокой нагрузке.
- Наибольшее улучшение наблюдается при 100 и 1000 одновременных запросах, где среднее время выполнения и throughput
  значительно улучшились.
- Это указывает на то, что индексы эффективно справляются с увеличением нагрузки, улучшая производительность системы.


- [График для одного запроса, без индексов: ](graph_results_1thread.png)
- [График для десяти запросов, без индексов: ](graph_results_10thread.png)
- [График для ста запросов, без индексов: ](graph_results_100thread.png)
- [График для тысячи запросов, без индексов: ](graph_results_1000thread.png)


- [График для одного запроса, с индексами: ](graph_results_1thread_whit_index.png)
- [График для десяти запросов, с индексами: ](graph_results_10thread_whit_index.png)
- [График для ста запросов, с индексами: ](graph_results_100thread_whit_index.png)
- [График для тысячи запросов, с индексами: ](graph_results_1000thread_whit_index.png)

## Схема базы данных

```sql
CREATE TYPE gender_enum AS ENUM ('MALE', 'FEMALE');

CREATE TABLE users
(
    id         BIGSERIAL PRIMARY KEY,
    first_name VARCHAR(50)  NOT NULL,
    last_name  VARCHAR(50)  NOT NULL,
    birth_date DATE         NOT NULL,
    gender     gender_enum  NOT NULL,
    email      VARCHAR(100) NOT NULL UNIQUE,
    password   VARCHAR(100) NOT NULL,
    is_active  BOOLEAN DEFAULT TRUE,
    city_id    BIGINT       NOT NULL,
    token_id   BIGINT,

    CONSTRAINT fk_city FOREIGN KEY (city_id) REFERENCES cities (id),
    CONSTRAINT fk_token FOREIGN KEY (token_id) REFERENCES tokens (id)
);

-- Индексы для внешних ключей
CREATE INDEX idx_users_city_id ON users (city_id);
CREATE INDEX idx_users_token_id ON users (token_id);

-- Индексы для фильтрации
CREATE INDEX idx_users_is_active ON users (is_active);
CREATE INDEX idx_users_gender ON users (gender);

-- Составной индекс для gender и is_active
CREATE INDEX idx_users_gender_is_active ON users (gender, is_active);

-- Обычный составной индекс (без varchar_pattern_ops)
CREATE INDEX idx_users_firstname_lastname ON users (first_name, last_name);

-- Индексы для оптимизации LIKE по префиксу (отдельные поля)
CREATE INDEX idx_users_first_name_pattern ON users (first_name varchar_pattern_ops);
CREATE INDEX idx_users_last_name_pattern ON users (last_name varchar_pattern_ops);

-- Составной индекс для оптимизации LIKE по префиксу (оба поля)
CREATE INDEX idx_users_firstname_lastname_pattern ON users
    (first_name varchar_pattern_ops, last_name varchar_pattern_ops);
